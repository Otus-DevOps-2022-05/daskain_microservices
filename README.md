# daskain_microservices
daskain microservices repository

# Выполнено ДЗ №14

 - [x] Основное ДЗ
 - [ ] Задание со *

## В процессе сделано:
 - Разбирался как сети работают в Докере
 - Разобрался с docker-compose
 - Разобраться с параметризацией docker-compose

### Запуск nginx
Мы используем одну сеть с одним набором портов. Т.к. мы запускаем экземпляры NGINX на одном и том же порту, то рабочим будет только последний контейнер


### Параметры docker-compose
Судя по доке, имя проекта береться от имени папки, в которой лежит файл docker-compose. Его можно переопределить задав через флаг -p при запуске docker-compose:
```
docker-compose -p project_name up -d
```

Второй способ - использовать файл с параметрами .env. В него можно добавить все параметры, которые мы сможем параметризировать при создании файла.

## PR checklist
 - [ ] Выставил label с номером домашнего задания
 - [x] Выставил label с темой домашнего задания


# Выполнено ДЗ №15

 - [x] Основное ДЗ
 - [x] Задание со * Автоматизация развёртывания GitLab (по желанию)
 - [x] Задание со * Регистрация ранера через Ansible

## В процессе сделано:
 - Развернул инстанс для Gitlab
 - При помощи Ansible  развернул на хосте gitlab
 - Запушил infra репозиторий в Gitlab

### Инстанс для gitlab
Создал инстанс через yc-cli:
```
yc compute instance create   --name gitlab-ci-vm   --memory=8   --zone ru-central1-a   --network-interface subnet-name=default-ru-central1-a,nat-ip-version=ipv4   --create-boot-disk image-folder-id=standard-images,image-family=ubuntu-1804-lts,size=50   --ssh-key ./id_rsa.pub
```

### Gitlab и Ansible

Развернул инстанс при помощи Ansible playbook. На первом этапе подготовил хост (установил doker + окружение для него). На втором этапе, через шаблон, создал compose файл для запуска Gitlab.

Пароль для рута генериться при запуске контейнера, его можн найти в файле сонфигурации на хосте:
```
daskain@gitlab-ci-vm:/srv/gitlab/config$ sudo cat /srv/gitlab/config/initial_root_password
```

### Пайплайны
Создал пайплайн для инфра репозитория. Зарегистрировал раннер вручную. Создал Ansible плэйбук для регистрации ранеров.

Тесты не запустились, коллеги посоветовали добавить памяти в инстанс

### Запуск контейнера с reddit
Добавил в пайплайн, в build добавил использование ранее созданого docker образа



## PR checklist
 - [ ] Выставил label с номером домашнего задания
 - [x] Выставил label с темой домашнего задания
